const express = require('express');
const app = express();
const port = 3010;

// 1. Global Middleware (–ì–ª–æ–±–∞–ª—å–Ω—ã–π)
// –ë—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
app.use((req, res, next) => {
    console.log('üåç –ì–ª–æ–±–∞–ª—å–Ω—ã–π middleware:', new Date().toLocaleString());
    next();
});


// 2. Local Middleware (–õ–æ–∫–∞–ª—å–Ω—ã–π)
// –ë—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
const routeMiddleware = (req, res, next) => {
    console.log('üéØ –õ–æ–∫–∞–ª—å–Ω—ã–π middleware –¥–ª—è /route');
    next();
};

app.get('/route', routeMiddleware, (req, res) => {
    res.send('–û—Ç–≤–µ—Ç –∏–∑ /route');
});

// 3. Embedded Middleware (–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π)
// Express.json() - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON-–¥–∞–Ω–Ω—ã—Ö
app.use(express.json());
// Express.static() - –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
app.use(express.static('public'));

// 4. Custom Middleware (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π)
const customMiddleware = (req, res, next) => {
    console.log(`üõ£Ô∏è –ü—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞: ${req.path}`);
    next();
};

app.use(customMiddleware);

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ middleware
app.post('/api/data', (req, res) => {
    // –ë–ª–∞–≥–æ–¥–∞—Ä—è express.json() –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å req.body
    console.log('üì¶ –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', req.body);
    res.json({ message: '–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã' });
});

// –ü—Ä–æ—Å—Ç–æ–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
app.get('/', (req, res) => {
    res.send(`
        <h1>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Middleware</h1>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–∞–±–æ—Ç—É middleware</p>
        <ul>
            <li><a href="/route">–¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ middleware (/route)</a></li>
            <li><a href="/api/data">–¢–µ—Å—Ç POST –∑–∞–ø—Ä–æ—Å–∞ (/api/data)</a></li>
        </ul>
    `);
});

app.listen(port, () => {
    console.log(`
    üöÄ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:${port}
    
    –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
    1. GET  /            - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    2. GET  /route       - –¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ middleware
    3. POST /api/data    - –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON –¥–∞–Ω–Ω—ã—Ö
    
    üí° –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è POST –∑–∞–ø—Ä–æ—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Postman –∏–ª–∏ curl:
    curl -X POST -H "Content-Type: application/json" -d '{"test":"data"}' http://localhost:${port}/api/data
    `);
});

/*
–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:
1. –¢–∏–ø—ã middleware:
   - –ì–ª–æ–±–∞–ª—å–Ω—ã–π (app.use) - –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –õ–æ–∫–∞–ª—å–Ω—ã–π (routeMiddleware) - –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
   - –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π (express.json, express.static) - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Express
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π (customMiddleware) - —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

2. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
   - –í—Å–µ middleware –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ req, res –∏ next
   - –ü–æ—Ä—è–¥–æ–∫ middleware –≤–∞–∂–µ–Ω (–≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑)
   - next() –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–º—É middleware
   - –ú–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã middleware

3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
   - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π
*/